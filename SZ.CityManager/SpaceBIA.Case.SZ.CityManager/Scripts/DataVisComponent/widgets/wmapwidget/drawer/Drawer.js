define(["dojo/_base/declare","../common/Class","../common/WMapUtils","../common/MVCObject","../component/DataRange"],function(t,i,a,n,e){return t("Drawer",[n],{colors:["rgba(17, 102, 252, 0.8)","rgba(52, 139, 251, 0.8)","rgba(110, 176, 253, 0.8)","rgba(255, 241, 193, 0.8)","rgba(255, 146, 149, 0.8)","rgba(253, 98, 104, 0.8)","rgba(255, 0, 0, 0.8)","rgba(255, 51, 61, 0.8)"],constructor:function(t){this.mapv=t._mapv,this.initOptions({layer:t,map:t.getMap(),ctx:null,mapv:null,animationOptions:{},drawOptions:{size:2}}),this.dataRange=new e(t),this.bindTo("ctx",t),this.bindTo("animationOptions",t),this.bindTo("drawOptions",t),this.bindTo("mapv",t),this.bindTo("map",t)},beginDrawMap:function(){"2d"==this.getLayer().getContext()&&this.beginDrawCanvasMap()},endDrawMap:function(){"2d"==this.getLayer().getContext()&&this.endDrawCanvasMap()},beginDrawCanvasMap:function(){var t=this.getDrawOptions(),i=this.getCtx(),n=(new a).getPixelRatio(i);i.save(),i.scale(n,n);for(var e=["globalCompositeOperation","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","globalAlpha","fillStyle","strokeStyle","lineCap","lineJoin","lineWidth","miterLimit"],s=0;s<e.length;s++)t[e[s]]&&(i[e[s]]=t[e[s]])},endDrawCanvasMap:function(){var t=this.getCtx();t.restore()},drawOptions_changed:function(){var t=this.getDrawOptions();t&&t.splitList?this.splitList=t.splitList:this.generalSplitList()},generalSplitList:function(){var t=this.getLayer().getDataRange(),i=Math.ceil((t.max-t.min)/7),a=t.min;this.splitList=[];for(var n=1;a<t.max;)this.splitList.push({start:a,end:a+i,size:n,color:this.colors[n-1]}),a+=i,n++},getRadius:function(){var t=this.getMap().getZoom(),i=Math.pow(2,18-t),a=this.getDrawOptions(),n=parseFloat(a.size)||13,e=a.unit||"px";return"m"===e?n/=i:n=n,a.minPxSize&&n<a.minPxSize&&(n=a.minPxSize),n}})});