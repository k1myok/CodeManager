define(["dojo/_base/declare","../common/Class","../common/WMapUtils","./Drawer"],function(t,e,a,n){return t("IntensityDrawer",[n],{constructor:function(){this.inherited(arguments),this.masker={min:0,max:0},this.defaultGradient={"0.0":"yellow","1.0":"red"},this._tmpCanvas=document.createElement("canvas")},drawMap:function(){var t=this;this.Scale&&this.Scale.set({min:0,max:t.getMax(),colors:t.getGradient()}),this.dataRange.setMax(t.getMax()),this.beginDrawMap();var e=this.getCtx();e.clearRect(0,0,e.canvas.width,e.canvas.height);var n=this.getLayer().getData(),i=this.getDrawOptions();e.strokeStyle=i.strokeStyle;var r=e.canvas.width,o=e.canvas.height,s=this.getRadius(),l=this.getLayer().getDataType(),m=i.label,g=this.getMap().getZoom();if(m){m.font&&(e.font=m.font);var h=m.key||"count"}if("polygon"===l||"polyline"===l)for(var c=0,f=n.length;f>c;c++){var y=n[c],d=y.pgeo,p=t.masker.min&&y.count<t.masker.min,u=t.masker.max&&y.count>t.masker.max;if(!p&&!u){e.beginPath(),e.moveTo(d[0][0],d[0][1]),e.fillStyle=this.dataRange.getColorByGradient(n[c].count);for(var v=1;v<d.length;v++)e.lineTo(d[v][0],d[v][1]);if("polygon"==l&&(e.closePath(),e.fill()),"polyline"==l?(e.strokeStyle=this.dataRange.getColorByGradient(n[c].count),e.stroke()):i.strokeStyle&&e.stroke(),m&&m.show&&(!m.minZoom||m.minZoom&&g>=m.minZoom)){m.fillStyle&&(e.fillStyle=m.fillStyle);var x=(new a).getGeoCenter(d);e.fillText(n[c][h],x[0],x[1])}}}else for(var c=0,f=n.length;f>c;c++){var y=n[c];if(!(y.px<0||y.px>r||y.py<0||y.py>o)){var p=t.masker.min&&y.count<t.masker.min,u=t.masker.max&&y.count>t.masker.max;p||u||(e.beginPath(),e.moveTo(y.px,y.py),e.fillStyle=this.dataRange.getColorByGradient(y.count),e.arc(y.px,y.py,s||1,0,2*Math.PI),e.closePath(),e.fill())}}i.strokeStyle&&e.stroke(),this.endDrawMap()},getGradient:function(){return this.getDrawOptions().gradient||this.defaultGradient},scale:function(t){var e=this;t.change(function(t,a){e.masker={min:t,max:a},e.drawMap()}),e.Scale=t},getMax:function(){var t=this.getLayer().getDataRange(),e=t.max;return this.getDrawOptions().max&&(e=this.getDrawOptions().max),e}})});