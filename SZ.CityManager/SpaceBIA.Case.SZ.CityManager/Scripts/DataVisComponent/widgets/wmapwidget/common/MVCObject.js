define(["dojo/_base/declare","./Accessor","./WMapUtils"],function(e,t){return e("MVCObject",null,{uuid:0,bindings:"__bindings__",accessors:"__accessors__",uid:"__uid__",constructor:function(){this.getterNameCache={},this.setterNameCache={}},capitalize:function(e){return e.substr(0,1).toUpperCase()+e.substr(1)},getUid:function(e){return e[this.uid]||(e[this.uid]=++this.uuid)},toKey:function(e){return"_"+e},getGetterName:function(e){return this.getterNameCache.hasOwnProperty(e)?this.getterNameCache[e]:this.getterNameCache[e]="get"+this.capitalize(e)},getSetterName:function(e){return this.setterNameCache.hasOwnProperty(e)?this.setterNameCache[e]:this.setterNameCache[e]="set"+this.capitalize(e)},triggerChange:function(e,t){var r=t+"_changed",s=this;if(e[r]?e[r]():"function"==typeof e.changed&&e.changed(t),e[s.bindings]&&e[s.bindings][t]){var n,i,a=e[s.bindings][t];for(i in a)a.hasOwnProperty(i)&&(n=a[i],s.triggerChange(n.target,n.targetKey))}},get:function(e){var t=this;if(t[t.accessors]&&t[t.accessors].hasOwnProperty(e)){var r,s=t[t.accessors][e],n=s.targetKey,i=s.target,a=t.getGetterName(n);r=i[a]?i[a]():i.get(n),s.to&&(r=s.to(r))}else t.hasOwnProperty(t.toKey(e))&&(r=t[t.toKey(e)]);return r},set:function(e,t){var r=this;if(r[r.accessors]&&r[r.accessors].hasOwnProperty(e)){var s=r[r.accessors][e],n=s.targetKey,i=s.target,a=r.getSetterName(n);s.from&&(t=s.from(t)),i[a]?i[a](t):i.set(n,t)}else r[r.toKey(e)]=t,r.triggerChange(r,e);return r},changed:function(){},notify:function(e){var t=this;if(t[t.accessors]&&t[t.accessors].hasOwnProperty(e)){var r=t[t.accessors][e],s=r.targetKey,n=r.target;n.notify(s)}else t.triggerChange(t,e);return t},setValues:function(e){var t,r,s,n=this;for(t in e)e.hasOwnProperty(t)&&(s=e[t],r=n.getSetterName(t),n[r]?n[r](s):n.set(t,s));return n},setOptions:this.setValues,bindTo:function(e,r,s,n){s||(s=e);var i=this;i.unbind(e),i[i.accessors]||(i[i.accessors]={}),r[i.bindings]||(r[i.bindings]={}),r[i.bindings][s]||(r[i.bindings][s]={});var a=new t(i,e),c=new t(r,s);return i[i.accessors][e]=c,r[i.bindings][s][i.getUid(i)]=a,n||i.triggerChange(i,e),c},unbind:function(e){var t=this;if(t[t.accessors]){var r=t[t.accessors][e];if(r){var s=r.target,n=r.targetKey;t[t.toKey(e)]=t.get(e),delete s[t.bindings][n][t.getUid(t)],delete t[t.accessors][e]}}return t},unbindAll:function(){var e=this;if(e[e.accessors]){var t=e[e.accessors];for(var r in t)t.hasOwnProperty(r)&&e.unbind(r)}return e},initOptions:function(e){var t=this;for(var r in e)t[t.getGetterName(r)]=function(e){return function(){return t.get(e)}}(r),t[t.getSetterName(r)]=function(e){return function(r){t.set(e,r)}}(r),t[t.toKey(r)]=e[r]}})});