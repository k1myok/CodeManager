define(["dojo/_base/declare","./Transitions"],function(n,t){return n("Animation",null,{_beginTime:null,_endTime:null,defaultOptions:{duration:1e3,fps:30,delay:0,transition:(new t).Transitions.linear,onStop:function(){}},INFINITE:"INFINITE",constructor:function(n){var t=this;if(this._anis=[],n)for(var i in n)t.defaultOptions[i]=n[i];this._opts=t.defaultOptions,this.isNumber(t.defaultOptions.delay)?setTimeout(function(){t.start()},t.defaultOptions.delay):t.defaultOptions.delay!=t.INFINITE&&this.start()},start:function(){this._beginTime=this.getCurrentTime(),this._endTime=this._beginTime+this._opts.duration,this._launch()},add:function(n){this._anis.push(n)},_launch:function(){var n=this,t=this.getCurrentTime();if(t>=n._endTime){if(n._opts.render&&n._opts.render(n._opts.transition(1)),n._opts.finish&&n._opts.finish(),n._anis.length>0){var i=n._anis[0];i._anis=[].concat(n._anis.slice(1)),i.start()}}else n.schedule=n._opts.transition((t-n._beginTime)/n._opts.duration),n._opts.render&&n._opts.render(n.schedule),n.terminative||(n._timer=setTimeout(function(){n._launch()},1e3/n._opts.fps))},stop:function(n){var t=this;t.terminative=!0;for(var i=0;i<this._anis.length;i++)t._anis[i].stop(),t._anis[i]=null;t._anis.length=0,t._timer&&(clearTimeout(t._timer),t._timer=null),t._opts.onStop(t.schedule),n&&(t._endTime=t._beginTime,t._launch())},cancel:function(){var n=this;n._timer&&clearTimeout(n._timer),n._endTime=n._beginTime,n.schedule=0},setFinishCallback:function(n){var t=this;t._anis.length>0?t._anis[t._anis.length-1]._opts.finish=n:t._opts.finish=n},Transitions:{linear:function(n){return n},reverse:function(n){return 1-n},easeInQuad:function(n){return n*n},easeInCubic:function(n){return Math.pow(n,3)},easeOutQuad:function(n){return-(n*(n-2))},easeOutCubic:function(n){return Math.pow(n-1,3)+1},easeInOutQuad:function(n){return.5>n?n*n*2:-2*(n-2)*n-1},easeInOutCubic:function(n){return.5>n?4*Math.pow(n,3):4*Math.pow(n-1,3)+1},easeInOutSine:function(n){return(1-Math.cos(Math.PI*n))/2}},getCurrentTime:function(){return(new Date).getTime()},isNumber:function(n){return"number"==typeof n}})});