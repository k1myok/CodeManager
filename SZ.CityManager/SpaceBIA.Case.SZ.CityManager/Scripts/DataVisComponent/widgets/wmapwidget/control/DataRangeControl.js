define(["dojo/_base/declare","../common/WMapUtils"],function(t){return t("DataRangeControl",null,{defaultAnchor:"Bottom_Right",defaultOffset:{x:10,y:10},constructor:function(t){var e=this.canvas=document.createElement("canvas");switch(e.style.backgroundColor="rgba(255,255,255,0.5)",e.style.boxShadow="rgba(0,0,0,0.2) 0 0 4px 2px",e.style.border="1px solid #999999",e.style.borderRadius="4px",this.defaultAnchor){case"Bottom_Right":e.style.position="absolute",e.style.right=this.defaultOffset.x+"px",e.style.bottom=this.defaultOffset.y+"px"}return t.root.childNodes[0].appendChild(e),e},getContainer:function(){return this.canvas},drawSizeSplit:function(t,e){var a=this.canvas,i=this.getCanvasSize(t,"SizeSplit");a.width=i.w||100,a.height=i.h||190,a.style.width=i.w+"px"||"100px",a.style.height=i.h+"px"||"190px";for(var l=a.getContext("2d"),s=10,h=0,r=0;r<t.length;r++)t[r].size>h&&(h=t[r].size);for(var r=0;r<t.length;r++){s+=t[r].size,l.beginPath(),l.arc(h+5,s,t[r].size,0,2*Math.PI,!1);var n=t[r].start||"~",o=t[r].end||"~",c=n+" - "+o;l.closePath(),l.fillStyle=e.fillStyle||"rgba(50, 50, 200, 0.8)",l.fill(),l.fillStyle="rgba(30, 30, 30, 1)",l.fillText(c,2*h+10,s+6);var p=t[r].size+5;15>p&&(p=15),s+=p}},drawCategorySplit:function(t){var e=this.canvas,a=this.getCanvasSize(t,"CategorySplit");e.width=a.w||80,e.height=a.h||190,e.style.width=a.w+"px"||"80px",e.style.height=a.h+"px"||"190px";var i=e.getContext("2d"),l=0;for(var s in t)i.fillStyle=t[s],i.beginPath(),i.arc(15,25*l+15,5,0,2*Math.PI,!1),i.closePath(),i.fill(),i.fillStyle="#333",i.fillText(s,25,25*l+20),l++},drawChoroplethSplit:function(t,e){var a=this.canvas,i=this.getCanvasSize(t,"ChoroplethSplit");a.width=i.w||100,a.height=i.h||190,a.style.width=i.w+"px"||"100px",a.style.height=i.h+"px"||"190px";var l=a.getContext("2d");l.fillStyle=e.fillStyle||"rgba(50, 50, 200, 0.8)";for(var s=0;s<t.length;s++){l.beginPath(),l.arc(15,25*s+15,5,0,2*Math.PI,!1);var h=(t[s].start||"~")+" - "+(t[s].end||"~");l.closePath(),l.fillStyle=t[s].color,l.fill(),l.fillStyle="#333",l.fillText(h,25,25*s+20)}},hide:function(){this.canvas&&(this.canvas.style.display="none")},show:function(){this.canvas&&(this.canvas.style.display="block")},getCanvasSize:function(t,e){var a,i,l,s=[];"[object Array]"==Object.prototype.toString.call(t)&&(l=t.length);var h={w:20,h:15,space:10};switch(e.toLowerCase()){case"sizesplit":case"choroplethsplit":for(var r=0;r<t.length;r++){var n=t[r].start||"~",o=t[r].end||"~",c=n+" - "+o;a=this.getByteLength(c),s.push(a)}break;case"categorysplit":var p=0;for(var f in t){var c=f+""||"——";a=this.getByteLength(c),s.push(a),p++}l=p}return i=Math.max.apply(Math,s),{w:8*i+h.w+3*h.space,h:l*h.h+(l+1)*h.space}},getByteLength:function(t){return(t||"").toString().trim().replace(/[^\x00-\xff]/g,"**").length}})});